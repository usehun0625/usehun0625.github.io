
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kevin의 블로그">
    <title>Amazon Elasticsearch 인덱싱, S3 저장 - Newline Character(&#39;
&#39;)가 포함된 데이터 처리 테스트 - Kevin의 블로그</title>
    <meta name="author" content="Kevin">
    
    
        <link rel="icon" href="http://usehun0625.github.io/assets/images/beer_favaicon.png">
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kevin","sameAs":["https://github.com/usehun0625/","mailto:usehun0625@gmail.com"],"image":"beer.jpg"},"articleBody":"\n다음과 같은 데이터 플로우에서 데이터 전송시 데이터 내용에 Newline Character(“\\n”) 포함하는 것과 관련하여 테스트 한 내용을 정리한다.\n\nData Sender → Kinesis Data Stream → Kinesis Data Firehose → Amazon Elasticsearch, S3(Back up)\n\n\n테스트는 Newline Character 관련하여 아래와 같은 테스트 케이스로 이루어져 있다.\n\n데이터 레코드 단위마다 1개 이벤트 데이터에 Newline Character를 추가하여 전송하는 케이스\n데이터 레코드 단위마다 여러 개의 이벤트 데이터를 Newline Character를 Delimeter로 사용하여 전송하는 케이스\n\n다음은 테스트 케이스에 대한 이해를 돕기 위한 예시이다.\n12# 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Charactor를 추가하여 전송하는 케이스&#123;\"user_id\" : 1000, \"board_id\" : 10000, \"playtime\" : 0&#125;\\n\n\n12# 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Charactor를 사용하여 전송하는 케이스&#123;\"user_id\" : 1000, \"board_id\" : 10000, \"playtime\" : 0&#125;\\n&#123;\"user_id\" : 1001, \"board_id\" : 10001, \"playtime\" : 7&#125;\\n&#123;\"user_id\" : 1002, \"board_id\" : 10002, \"playtime\" : 3&#125;\\n\n\n테스트 환경로컬환경\nOS : macOS Catalina v10.15.2\nPython : v3.7.4\nboto3 : v1.10.46\n\nKinesis Datastream\n샤드수 : 1\n쓰기 : 1 MB/초, 1000 레코드/초\n읽기 : 2 MB/초\n\nKinesis Data Firehose\nSource\nKinesis Data Stream\n\n\nDestination\nAmazone Elastcisearch\n인덱스 : newline_character_test\nNo index rotation\n타입 : _doc\nbuffer condtion : 1 MB or 60 seconds\n\n\nS3 (Backup bucket)\n버킷명 : kevin-bucket-test\nPrefix : newline_character_test/\n\n\n\n\n\nAmazon Elasticsearch\nElasticsearch 7.1\n인스턴스 구성\n인스턴스 유형 : t2.medium.elasticsearch (vCPU 2, Memory 4GiB)\n인스턴스 개수 : 2\n인스턴스별 일반 EBS(SSD) 10GB 각 1개\n테스트 인덱스 : newline_character_test\n\n테스트 환경 구성테스트를 위하여 다음과 같은 디렉터리를 구성한다.\n123es_indexing_test_newline_character├── data_sender.py ### 데이터 전송하는 파이썬 코드└── input ### 전송할 데이터를 저장하는 디렉터리\n\nData Sender 만들기Data Sender는 다음과 같은 동작을 한다.\n\n디렉터리를 탐색하여 log 확장자를 갖는 파일들의 리스트를 만든다.\n파일 리스트를 탐색하여 파일에 접근하여 파일 내용 전부를 String 타입으로 읽어온다.\nString 타입 파일 내용은 1개의 데이터 레코드에 저장하고, boto3 라이브러리를 사용하여 Data Stream에 데이터를 전송한다.\n파일 1개의 내용은 데이터 레코드 1개에 저장하여 Data Stream에 전송한다.\n\n가상 환경을 구성하고 활성화 한다. AWS Kinesis 라이브러리인 boto3를 설치한다.\n123$ virtualenv --python=python3.7 .venv$ source .venv/bin/activate$ pip install boto3\n\n앞서 설명한 Data Sender를 파이썬으로 구현하면 다음과 같으며 테스트 디렉터리에 추가한다.\n\ndata_sender.py\n\n\n\n테스트 : 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Character를 추가하여 전송하는 케이스테스트 데이터 추가하고 Data Sender 실행하기./input 경로에 다음과 같은 3개의 파일을 추가한다. 각각의 파일 내용중 이벤트 데이터 끝에는 Newline Character(“\\n”)가 포함되어야 한다.\n12# test1.log&#123;\"user_id\" : 1000, \"board_id\" : 10000, \"playtime\" : 0&#125;\\n\n\n12# test2.log&#123;\"user_id\" : 1001, \"board_id\" : 10002, \"playtime\" : 15&#125;\\n\n\n12# test3.log&#123;\"user_id\" : 1002, \"board_id\" : 10002, \"playtime\" : 1&#125;\\n\n\n앞서 만든 Data Sender를 실행하여 Data Stream에 전송한다.\n1$ python data_sender.py\n\nAmazon Elasticsearch에 데이터 저장 확인Data Sender로 전송한 데이터가 newline_character_test 인덱스에 저장되었는지 확인한다. Kinesis Data Firehose의 Buffer Condition을 고려하여 5분정도 지나고 확인한다.테스트에서는 Kibana를 사용하여 전송한 데이터가 Elasticsearch에 저장 되었는지 확인하였으며, 앞서 Data Sender에서 보낸 데이터가 newline_character_test 인덱스에 다큐먼트로 저장된 것을 확인했다.\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354Request : GET newline_character_test/_searchResponse :&#123;  \"took\" : 1,  \"timed_out\" : false,  \"_shards\" : &#123;    \"total\" : 5,    \"successful\" : 5,    \"skipped\" : 0,    \"failed\" : 0  &#125;,  \"hits\" : &#123;    \"total\" : &#123;      \"value\" : 3,      \"relation\" : \"eq\"    &#125;,    \"max_score\" : 1.0,    \"hits\" : [      &#123;        \"_index\" : \"newline_character_test\",        \"_type\" : \"_doc\",        \"_id\" : \"49601782789714450298329765366626631488549916886083567618.0\",        \"_score\" : 1.0,        \"_source\" : &#123;          \"user_id\" : 1000,          \"board_id\" : 10000,          \"playtime\" : 0        &#125;      &#125;,      &#123;        \"_index\" : \"newline_character_test\",        \"_type\" : \"_doc\",        \"_id\" : \"49601782789714450298329765366630258266008760773607686146.0\",        \"_score\" : 1.0,        \"_source\" : &#123;          \"user_id\" : 1002,          \"board_id\" : 10002,          \"playtime\" : 1        &#125;      &#125;,      &#123;        \"_index\" : \"newline_character_test\",        \"_type\" : \"_doc\",        \"_id\" : \"49601782789714450298329765366632676117647990031957098498.0\",        \"_score\" : 1.0,        \"_source\" : &#123;          \"user_id\" : 1001,          \"board_id\" : 10002,          \"playtime\" : 15        &#125;      &#125;    ]  &#125;&#125;\n\nS3에 저장된 데이터 확인kevin-bucket-test 버킷에서 Firehose가 생성한 백업 파일을 확인한다.테스트에서는 S3 콘솔로 확인하였으며, kevin-bucket-test 버킷 하위에 DataFirehose도메인명-1-2020-01-14-07-35-02-974b422a-6ca9-41ad-8e04-5a30d654eff1 파일이 생성된 것을 확인했다.\n해당 파일의 내용을 확인하면 다음과 같다.\n123&#123;\"user_id\" : 1000, \"board_id\" : 10000, \"playtime\" : 0&#125;&#123;\"user_id\" : 1002, \"board_id\" : 10002, \"playtime\" : 1&#125;&#123;\"user_id\" : 1001, \"board_id\" : 10002, \"playtime\" : 15&#125;\n\nJSON 형태의 데이터가 라인별로 한개씩 저장되어 있는(Newline Character 처리되어) 것을 확인 수 있다.\n테스트 케이스 결과\n이벤트 데이터에 Newline Character(“\\n”)를 포함한 String 타입 값을 데이터 레코드 단위마다 저장하여 Data Stream에 전송했다.각각의 이벤트 데이터는 Amazon Elasticsearch에 다큐먼트로 매칭되어 저장된다.백업용 S3 파일에는 앞서 전송한 이벤트 데이터가 New Character(“\\n”)로 파일에 라인별로 분리되어 저장된다.\n\n테스트 : 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Character를 사용하여 전송하는 케이스테스트 데이터 추가하고 Data Sender 실행하기./input 경로에 다음과 같은 1개의 파일을 추가한다.\n1234# test1.log&#123;\"user_id\" : 2000, \"board_id\" : 20000, \"playtime\" : 0&#125;&#123;\"user_id\" : 2001, \"board_id\" : 20002, \"playtime\" : 1&#125;&#123;\"user_id\" : 2002, \"board_id\" : 20002, \"playtime\" : 2&#125;\\n\n\n앞서 만든 Data Sender를 실행하여 Kinesis Data Stream에 전송한다.\n1$ python data_sender.py\n\nAmazon Elasticsearch에 데이터 저장 확인Data Sender로 전송한 데이터가 newline_character_test 인덱스에 저장되었는지 확인한다. Data Firehose의 Buffer Condition을 고려하여 5분정도 지나고 확인한다.테스트에서는 Kibana를 사용하여 Elasticsearch에 데이터가 저장 되었는지 확인했다. newline_character_test 인덱스에는 어떠한 다큐먼트도 저장되지 않았다.\n1234567891011121314151617181920Request : GET newline_character_test/_searchResponse :&#123;  \"took\" : 1,  \"timed_out\" : false,  \"_shards\" : &#123;    \"total\" : 5,    \"successful\" : 5,    \"skipped\" : 0,    \"failed\" : 0  &#125;,  \"hits\" : &#123;    \"total\" : &#123;      \"value\" : 0,      \"relation\" : \"eq\"    &#125;,    \"max_score\" : null,    \"hits\" : [ ]  &#125;&#125;\n\nS3에 저장된 데이터 확인kevin-bucket-test 버킷에서 Firehose가 생성한 백업 파일을 확인한다.테스트에서는 S3 콘솔로 확인하였으며, kevin-bucket-test 버킷 하위에 newline_character_test/2020/01/14/07/ 경로에 DataFirehose도메인명-2020-01-14-07-46-15-e9d02359-69ba-4894-955d-c223afb8ec37 파일이 생성된 것을 확인했다.\n해당 파일의 내용을 확인하면 다음과 같다.\n123&#123;\"user_id\" : 2000, \"board_id\" : 20000, \"playtime\" : 0&#125;&#123;\"user_id\" : 2001, \"board_id\" : 20002, \"playtime\" : 1&#125;&#123;\"user_id\" : 2002, \"board_id\" : 20002, \"playtime\" : 2&#125;\n\n추가적으로 kevin-bucket-test 버킷 하위에 newline_character_test/elasticsearch-failed/2020/01/14/07/ 경로에 DataFirehose도메인명-2020-01-14-07-46-15-a588bc33-f5e0-4e99-8990-5d22541d0cff 파일이 생성된 것을 확인하였다.\n해당 파일 내용은 다음과 같으며, 전송한 데이터 레코드 형식이 Elasticsearch 형식가 맞지 않는다는 내용이다.\n1&#123;\"attemptsMade\":4,\"arrivalTimestamp\":1578987975128,\"errorCode\":\"ES.MalformedData\",\"errorMessage\":\"One or more records are malformed. Please ensure that each record is single valid JSON object and that it does not contain newlines.\",\"attemptEndingTimestamp\":1578988096793,\"rawData\":\"eyJ1c2VyX2lkIiA6IDIwMDAsICJib2FyZF9pZCIgOiAyMDAwMCwgInBsYXl0aW1lIiA6IDB9CnsidXNlcl9pZCIgOiAyMDAxLCAiYm9hcmRfaWQiIDogMjAwMDIsICJwbGF5dGltZSIgOiAxfQp7InVzZXJfaWQiIDogMjAwMiwgImJvYXJkX2lkIiA6IDIwMDAyLCAicGxheXRpbWUiIDogMn0K\",\"subsequenceNumber\":0,\"esDocumentId\":\"49601782789714450298329765741201416363766281254427688962.0\",\"esIndexName\":\"newline_character_test\",\"esTypeName\":\"\"&#125;\n\n테스트 케이스 결과\n1개의 데이터 레코드에 3개의 이벤트 데이터를 Newline Character(“\\n”)를 Delimeter로 사용하여 String 타입 값으로 저장하여 Kinesis Data Stream에 전송하였다.S3에는 앞서 전송한 3개의 이벤트 데이터와 파일로 저장된다.하지만 Amazon Elasticsearch에 인덱싱되지 않았으며, 인덱싱 되지 않은 이유는 Elastcisearch 인덱싱 형식에 맞지 않기 때문이다.\n\n테스트 결과아래에는 테스트 케이스 별로 테스트한 내용을 정리한다.\n\n데이터 전송시 데이터 레코드 단위마다 1개의 이벤트 데이터에 Newline Character(“\\n”)를 붙여서 저장하여 전송하는 경우\n\n각각의 이벤트 데이터는 Amazon Elasticsearch에 다큐먼트로 매칭되어 저장된다.\nS3에 이벤트 데이터가 New Character(“\\n”)가 처리되어 한 라인에 하나의 데이터가 저장되는 형태로 파일에 저장된다.\n\n데이터 전송시 데이터 1개의 레코드에 3개의 이벤트 데이터를 Newline Character(“\\n”)를 Delimeter로 사용하여 하나의 문자열 형태로 전송하는 경우\n\nAmazon Elasticsearch에 인덱싱되지 않으며, 인덱싱 되지 않는 이유는 Elastcisearch 인덱싱 형식에 맞지 않기 때문이다.\nS3에 3개의 이벤트 데이터와 이벤트간 Delimeter로 Newline Character가 포함된 값이 파일로 저장된다.\n\n\n","dateCreated":"2020-01-15T23:33:44+09:00","dateModified":"2020-02-11T00:53:34+09:00","datePublished":"2020-01-15T23:33:44+09:00","description":"\n다음과 같은 데이터 플로우에서 데이터 전송시 데이터 내용에 Newline Character(“\\n”) 포함하는 것과 관련하여 테스트 한 내용을 정리한다.\n\nData Sender → Kinesis Data Stream → Kinesis Data Firehose → Amazon Elasticsearch, S3(Back up)\n","headline":"Amazon Elasticsearch 인덱싱, S3 저장 - Newline Character('\n')가 포함된 데이터 처리 테스트","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"},"publisher":{"@type":"Organization","name":"Kevin","sameAs":["https://github.com/usehun0625/","mailto:usehun0625@gmail.com"],"image":"beer.jpg","logo":{"@type":"ImageObject","url":"beer.jpg"}},"url":"http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/","keywords":"Elasticsearch, Kinesis Data Stream, Kinesis Data Firehose"}</script>
    <meta name="description" content="다음과 같은 데이터 플로우에서 데이터 전송시 데이터 내용에 Newline Character(“\n”) 포함하는 것과 관련하여 테스트 한 내용을 정리한다.  Data Sender → Kinesis Data Stream → Kinesis Data Firehose → Amazon Elasticsearch, S3(Back up)">
<meta property="og:type" content="blog">
<meta property="og:title" content="Amazon Elasticsearch 인덱싱, S3 저장 - Newline Character(&#39;
&#39;)가 포함된 데이터 처리 테스트">
<meta property="og:url" content="http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/index.html">
<meta property="og:site_name" content="Kevin의 블로그">
<meta property="og:description" content="다음과 같은 데이터 플로우에서 데이터 전송시 데이터 내용에 Newline Character(“\n”) 포함하는 것과 관련하여 테스트 한 내용을 정리한다.  Data Sender → Kinesis Data Stream → Kinesis Data Firehose → Amazon Elasticsearch, S3(Back up)">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-01-15T14:33:44.000Z">
<meta property="article:modified_time" content="2020-02-10T15:53:34.248Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="Elasticsearch">
<meta property="article:tag" content="Kinesis Data Stream">
<meta property="article:tag" content="Kinesis Data Firehose">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://usehun0625.github.io/assets/images/beer.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Kevin의 블로그
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Kevin</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Kevin, 이용훈<br>어릴 때부터 코딩에 흥미를 가지고 살아왔습니다. 새로운 기술도 열정적으로 받아들이며 더 좋은 개발을 위하여 학습하고 경험하고 노력하고 있습니다.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/"
                            title="홈"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">홈</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="카테고리"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="태그"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="/all-archives"
                            
                            title="아카이브"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/usehun0625/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:usehun0625@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Amazon Elasticsearch 인덱싱, S3 저장 - Newline Character(&#39;
&#39;)가 포함된 데이터 처리 테스트
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-01-15T23:33:44+09:00">
	
		    Jan 15, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%A7%91/">데이터 수집</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-환경"><span class="toc-text">테스트 환경</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#로컬환경"><span class="toc-text">로컬환경</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinesis-Datastream"><span class="toc-text">Kinesis Datastream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinesis-Data-Firehose"><span class="toc-text">Kinesis Data Firehose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Amazon-Elasticsearch"><span class="toc-text">Amazon Elasticsearch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-환경-구성"><span class="toc-text">테스트 환경 구성</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-Sender-만들기"><span class="toc-text">Data Sender 만들기</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-데이터-레코드-단위마다-1개-이벤트-데이터와-Newline-Character를-추가하여-전송하는-케이스"><span class="toc-text">테스트 : 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Character를 추가하여 전송하는 케이스</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#테스트-데이터-추가하고-Data-Sender-실행하기"><span class="toc-text">테스트 데이터 추가하고 Data Sender 실행하기</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Amazon-Elasticsearch에-데이터-저장-확인"><span class="toc-text">Amazon Elasticsearch에 데이터 저장 확인</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#S3에-저장된-데이터-확인"><span class="toc-text">S3에 저장된 데이터 확인</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#테스트-케이스-결과"><span class="toc-text">테스트 케이스 결과</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-데이터-레코드-단위마다-여러-개의-이벤트-데이터를-저장하되-Delimeter로-Newline-Character를-사용하여-전송하는-케이스"><span class="toc-text">테스트 : 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Character를 사용하여 전송하는 케이스</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#테스트-데이터-추가하고-Data-Sender-실행하기-1"><span class="toc-text">테스트 데이터 추가하고 Data Sender 실행하기</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Amazon-Elasticsearch에-데이터-저장-확인-1"><span class="toc-text">Amazon Elasticsearch에 데이터 저장 확인</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#S3에-저장된-데이터-확인-1"><span class="toc-text">S3에 저장된 데이터 확인</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#테스트-케이스-결과-1"><span class="toc-text">테스트 케이스 결과</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-결과"><span class="toc-text">테스트 결과</span></a></li></ol>
<p>다음과 같은 데이터 플로우에서 데이터 전송시 데이터 내용에 Newline Character(“\n”) 포함하는 것과 관련하여 테스트 한 내용을 정리한다.</p>
<ul>
<li>Data Sender → Kinesis Data Stream → Kinesis Data Firehose → Amazon Elasticsearch, S3(Back up)</li>
</ul>
<a id="more"></a>
<p>테스트는 Newline Character 관련하여 아래와 같은 테스트 케이스로 이루어져 있다.</p>
<ul>
<li>데이터 레코드 단위마다 1개 이벤트 데이터에 Newline Character를 추가하여 전송하는 케이스</li>
<li>데이터 레코드 단위마다 여러 개의 이벤트 데이터를 Newline Character를 Delimeter로 사용하여 전송하는 케이스</li>
</ul>
<p>다음은 테스트 케이스에 대한 이해를 돕기 위한 예시이다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Charactor를 추가하여 전송하는 케이스</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1000, <span class="string">"board_id"</span> : 10000, <span class="string">"playtime"</span> : 0&#125;\n</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Charactor를 사용하여 전송하는 케이스</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1000, <span class="string">"board_id"</span> : 10000, <span class="string">"playtime"</span> : 0&#125;\n&#123;<span class="string">"user_id"</span> : 1001, <span class="string">"board_id"</span> : 10001, <span class="string">"playtime"</span> : 7&#125;\n&#123;<span class="string">"user_id"</span> : 1002, <span class="string">"board_id"</span> : 10002, <span class="string">"playtime"</span> : 3&#125;\n</span><br></pre></td></tr></table></figure>

<h1 id="테스트-환경"><a href="#테스트-환경" class="headerlink" title="테스트 환경"></a>테스트 환경</h1><h2 id="로컬환경"><a href="#로컬환경" class="headerlink" title="로컬환경"></a>로컬환경</h2><ul>
<li>OS : macOS Catalina v10.15.2</li>
<li>Python : v3.7.4</li>
<li>boto3 : v1.10.46</li>
</ul>
<h2 id="Kinesis-Datastream"><a href="#Kinesis-Datastream" class="headerlink" title="Kinesis Datastream"></a>Kinesis Datastream</h2><ul>
<li>샤드수 : 1</li>
<li>쓰기 : 1 MB/초, 1000 레코드/초</li>
<li>읽기 : 2 MB/초</li>
</ul>
<h2 id="Kinesis-Data-Firehose"><a href="#Kinesis-Data-Firehose" class="headerlink" title="Kinesis Data Firehose"></a>Kinesis Data Firehose</h2><ul>
<li>Source<ul>
<li>Kinesis Data Stream</li>
</ul>
</li>
<li>Destination<ul>
<li>Amazone Elastcisearch<ul>
<li>인덱스 : newline_character_test</li>
<li>No index rotation</li>
<li>타입 : _doc</li>
<li>buffer condtion : 1 MB or 60 seconds</li>
</ul>
</li>
<li>S3 (Backup bucket)<ul>
<li>버킷명 : kevin-bucket-test</li>
<li>Prefix : newline_character_test/</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Amazon-Elasticsearch"><a href="#Amazon-Elasticsearch" class="headerlink" title="Amazon Elasticsearch"></a>Amazon Elasticsearch</h2><ul>
<li>Elasticsearch 7.1</li>
<li>인스턴스 구성</li>
<li>인스턴스 유형 : t2.medium.elasticsearch (vCPU 2, Memory 4GiB)</li>
<li>인스턴스 개수 : 2</li>
<li>인스턴스별 일반 EBS(SSD) 10GB 각 1개</li>
<li>테스트 인덱스 : newline_character_test</li>
</ul>
<h1 id="테스트-환경-구성"><a href="#테스트-환경-구성" class="headerlink" title="테스트 환경 구성"></a>테스트 환경 구성</h1><p>테스트를 위하여 다음과 같은 디렉터리를 구성한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">es_indexing_test_newline_character</span><br><span class="line">├── data_sender.py <span class="comment">### 데이터 전송하는 파이썬 코드</span></span><br><span class="line">└── input <span class="comment">### 전송할 데이터를 저장하는 디렉터리</span></span><br></pre></td></tr></table></figure>

<h2 id="Data-Sender-만들기"><a href="#Data-Sender-만들기" class="headerlink" title="Data Sender 만들기"></a>Data Sender 만들기</h2><p>Data Sender는 다음과 같은 동작을 한다.</p>
<ul>
<li>디렉터리를 탐색하여 log 확장자를 갖는 파일들의 리스트를 만든다.</li>
<li>파일 리스트를 탐색하여 파일에 접근하여 파일 내용 전부를 String 타입으로 읽어온다.</li>
<li>String 타입 파일 내용은 1개의 데이터 레코드에 저장하고, boto3 라이브러리를 사용하여 Data Stream에 데이터를 전송한다.</li>
<li>파일 1개의 내용은 데이터 레코드 1개에 저장하여 Data Stream에 전송한다.</li>
</ul>
<p>가상 환경을 구성하고 활성화 한다. AWS Kinesis 라이브러리인 boto3를 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv --python=python3.7 .venv</span><br><span class="line">$ <span class="built_in">source</span> .venv/bin/activate</span><br><span class="line">$ pip install boto3</span><br></pre></td></tr></table></figure>

<p>앞서 설명한 Data Sender를 파이썬으로 구현하면 다음과 같으며 테스트 디렉터리에 추가한다.</p>
<ul>
<li><a href="/post_attachment/Amazon-Elasticsearch-인덱싱-S3-저장-Newline-Character-n-가-포함된-데이터-처리-테스트/data_sender.py" target="_blank">data_sender.py</a><!-- * [data_sender.py](/post_attachment/Amazon-Elasticsearch-인덱싱-S3-저장-Newline-Character-n-가-포함된-데이터-처리-테스트/data_sender.py) -->

</li>
</ul>
<h1 id="테스트-데이터-레코드-단위마다-1개-이벤트-데이터와-Newline-Character를-추가하여-전송하는-케이스"><a href="#테스트-데이터-레코드-단위마다-1개-이벤트-데이터와-Newline-Character를-추가하여-전송하는-케이스" class="headerlink" title="테스트 : 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Character를 추가하여 전송하는 케이스"></a>테스트 : 데이터 레코드 단위마다 1개 이벤트 데이터와 Newline Character를 추가하여 전송하는 케이스</h1><h2 id="테스트-데이터-추가하고-Data-Sender-실행하기"><a href="#테스트-데이터-추가하고-Data-Sender-실행하기" class="headerlink" title="테스트 데이터 추가하고 Data Sender 실행하기"></a>테스트 데이터 추가하고 Data Sender 실행하기</h2><p>./input 경로에 다음과 같은 3개의 파일을 추가한다. 각각의 파일 내용중 이벤트 데이터 끝에는 Newline Character(“\n”)가 포함되어야 한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1.log</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1000, <span class="string">"board_id"</span> : 10000, <span class="string">"playtime"</span> : 0&#125;\n</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test2.log</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1001, <span class="string">"board_id"</span> : 10002, <span class="string">"playtime"</span> : 15&#125;\n</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test3.log</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1002, <span class="string">"board_id"</span> : 10002, <span class="string">"playtime"</span> : 1&#125;\n</span><br></pre></td></tr></table></figure>

<p>앞서 만든 Data Sender를 실행하여 Data Stream에 전송한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python data_sender.py</span><br></pre></td></tr></table></figure>

<h2 id="Amazon-Elasticsearch에-데이터-저장-확인"><a href="#Amazon-Elasticsearch에-데이터-저장-확인" class="headerlink" title="Amazon Elasticsearch에 데이터 저장 확인"></a>Amazon Elasticsearch에 데이터 저장 확인</h2><p>Data Sender로 전송한 데이터가 newline_character_test 인덱스에 저장되었는지 확인한다. Kinesis Data Firehose의 Buffer Condition을 고려하여 5분정도 지나고 확인한다.<br>테스트에서는 Kibana를 사용하여 전송한 데이터가 Elasticsearch에 저장 되었는지 확인하였으며, 앞서 Data Sender에서 보낸 데이터가 newline_character_test 인덱스에 다큐먼트로 저장된 것을 확인했다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Request : GET newline_character_test/_search</span><br><span class="line">Response :</span><br><span class="line">&#123;</span><br><span class="line">  "took" : 1,</span><br><span class="line">  "timed_out" : false,</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 5,</span><br><span class="line">    "successful" : 5,</span><br><span class="line">    "skipped" : 0,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits" : &#123;</span><br><span class="line">    "total" : &#123;</span><br><span class="line">      "value" : 3,</span><br><span class="line">      "relation" : "eq"</span><br><span class="line">    &#125;,</span><br><span class="line">    "max_score" : 1.0,</span><br><span class="line">    "hits" : [</span><br><span class="line">      &#123;</span><br><span class="line">        "_index" : "newline_character_test",</span><br><span class="line">        "_type" : "_doc",</span><br><span class="line">        "_id" : "49601782789714450298329765366626631488549916886083567618.0",</span><br><span class="line">        "_score" : 1.0,</span><br><span class="line">        "_source" : &#123;</span><br><span class="line">          "user_id" : 1000,</span><br><span class="line">          "board_id" : 10000,</span><br><span class="line">          "playtime" : 0</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        "_index" : "newline_character_test",</span><br><span class="line">        "_type" : "_doc",</span><br><span class="line">        "_id" : "49601782789714450298329765366630258266008760773607686146.0",</span><br><span class="line">        "_score" : 1.0,</span><br><span class="line">        "_source" : &#123;</span><br><span class="line">          "user_id" : 1002,</span><br><span class="line">          "board_id" : 10002,</span><br><span class="line">          "playtime" : 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        "_index" : "newline_character_test",</span><br><span class="line">        "_type" : "_doc",</span><br><span class="line">        "_id" : "49601782789714450298329765366632676117647990031957098498.0",</span><br><span class="line">        "_score" : 1.0,</span><br><span class="line">        "_source" : &#123;</span><br><span class="line">          "user_id" : 1001,</span><br><span class="line">          "board_id" : 10002,</span><br><span class="line">          "playtime" : 15</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="S3에-저장된-데이터-확인"><a href="#S3에-저장된-데이터-확인" class="headerlink" title="S3에 저장된 데이터 확인"></a>S3에 저장된 데이터 확인</h2><p>kevin-bucket-test 버킷에서 Firehose가 생성한 백업 파일을 확인한다.<br>테스트에서는 S3 콘솔로 확인하였으며, kevin-bucket-test 버킷 하위에 <em>DataFirehose도메인명</em>-1-2020-01-14-07-35-02-974b422a-6ca9-41ad-8e04-5a30d654eff1 파일이 생성된 것을 확인했다.</p>
<p>해당 파일의 내용을 확인하면 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"user_id"</span> : 1000, <span class="string">"board_id"</span> : 10000, <span class="string">"playtime"</span> : 0&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1002, <span class="string">"board_id"</span> : 10002, <span class="string">"playtime"</span> : 1&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 1001, <span class="string">"board_id"</span> : 10002, <span class="string">"playtime"</span> : 15&#125;</span><br></pre></td></tr></table></figure>

<p>JSON 형태의 데이터가 라인별로 한개씩 저장되어 있는(Newline Character 처리되어) 것을 확인 수 있다.</p>
<h2 id="테스트-케이스-결과"><a href="#테스트-케이스-결과" class="headerlink" title="테스트 케이스 결과"></a>테스트 케이스 결과</h2><blockquote>
<p>이벤트 데이터에 Newline Character(“\n”)를 포함한 String 타입 값을 데이터 레코드 단위마다 저장하여 Data Stream에 전송했다.<br>각각의 이벤트 데이터는 Amazon Elasticsearch에 다큐먼트로 매칭되어 저장된다.<br>백업용 S3 파일에는 앞서 전송한 이벤트 데이터가 New Character(“\n”)로 파일에 라인별로 분리되어 저장된다.</p>
</blockquote>
<h1 id="테스트-데이터-레코드-단위마다-여러-개의-이벤트-데이터를-저장하되-Delimeter로-Newline-Character를-사용하여-전송하는-케이스"><a href="#테스트-데이터-레코드-단위마다-여러-개의-이벤트-데이터를-저장하되-Delimeter로-Newline-Character를-사용하여-전송하는-케이스" class="headerlink" title="테스트 : 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Character를 사용하여 전송하는 케이스"></a>테스트 : 데이터 레코드 단위마다 여러 개의 이벤트 데이터를 저장하되 Delimeter로 Newline Character를 사용하여 전송하는 케이스</h1><h2 id="테스트-데이터-추가하고-Data-Sender-실행하기-1"><a href="#테스트-데이터-추가하고-Data-Sender-실행하기-1" class="headerlink" title="테스트 데이터 추가하고 Data Sender 실행하기"></a>테스트 데이터 추가하고 Data Sender 실행하기</h2><p>./input 경로에 다음과 같은 1개의 파일을 추가한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1.log</span></span><br><span class="line">&#123;<span class="string">"user_id"</span> : 2000, <span class="string">"board_id"</span> : 20000, <span class="string">"playtime"</span> : 0&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 2001, <span class="string">"board_id"</span> : 20002, <span class="string">"playtime"</span> : 1&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 2002, <span class="string">"board_id"</span> : 20002, <span class="string">"playtime"</span> : 2&#125;\n</span><br></pre></td></tr></table></figure>

<p>앞서 만든 Data Sender를 실행하여 Kinesis Data Stream에 전송한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python data_sender.py</span><br></pre></td></tr></table></figure>

<h2 id="Amazon-Elasticsearch에-데이터-저장-확인-1"><a href="#Amazon-Elasticsearch에-데이터-저장-확인-1" class="headerlink" title="Amazon Elasticsearch에 데이터 저장 확인"></a>Amazon Elasticsearch에 데이터 저장 확인</h2><p>Data Sender로 전송한 데이터가 newline_character_test 인덱스에 저장되었는지 확인한다. Data Firehose의 Buffer Condition을 고려하여 5분정도 지나고 확인한다.<br>테스트에서는 Kibana를 사용하여 Elasticsearch에 데이터가 저장 되었는지 확인했다. <u>newline_character_test 인덱스에는 어떠한 다큐먼트도 저장되지 않았다.</u></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Request : GET newline_character_test/_search</span><br><span class="line">Response :</span><br><span class="line">&#123;</span><br><span class="line">  "took" : 1,</span><br><span class="line">  "timed_out" : false,</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 5,</span><br><span class="line">    "successful" : 5,</span><br><span class="line">    "skipped" : 0,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits" : &#123;</span><br><span class="line">    "total" : &#123;</span><br><span class="line">      "value" : 0,</span><br><span class="line">      "relation" : "eq"</span><br><span class="line">    &#125;,</span><br><span class="line">    "max_score" : null,</span><br><span class="line">    "hits" : [ ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="S3에-저장된-데이터-확인-1"><a href="#S3에-저장된-데이터-확인-1" class="headerlink" title="S3에 저장된 데이터 확인"></a>S3에 저장된 데이터 확인</h2><p>kevin-bucket-test 버킷에서 Firehose가 생성한 백업 파일을 확인한다.<br>테스트에서는 S3 콘솔로 확인하였으며, kevin-bucket-test 버킷 하위에 newline_character_test/2020/01/14/07/ 경로에 <em>DataFirehose도메인명</em>-2020-01-14-07-46-15-e9d02359-69ba-4894-955d-c223afb8ec37 파일이 생성된 것을 확인했다.</p>
<p>해당 파일의 내용을 확인하면 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"user_id"</span> : 2000, <span class="string">"board_id"</span> : 20000, <span class="string">"playtime"</span> : 0&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 2001, <span class="string">"board_id"</span> : 20002, <span class="string">"playtime"</span> : 1&#125;</span><br><span class="line">&#123;<span class="string">"user_id"</span> : 2002, <span class="string">"board_id"</span> : 20002, <span class="string">"playtime"</span> : 2&#125;</span><br></pre></td></tr></table></figure>

<p>추가적으로 kevin-bucket-test 버킷 하위에 newline_character_test/elasticsearch-failed/2020/01/14/07/ 경로에 <em>DataFirehose도메인명</em>-2020-01-14-07-46-15-a588bc33-f5e0-4e99-8990-5d22541d0cff 파일이 생성된 것을 확인하였다.</p>
<p>해당 파일 내용은 다음과 같으며, 전송한 데이터 레코드 형식이 Elasticsearch 형식가 맞지 않는다는 내용이다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"attemptsMade"</span>:<span class="number">4</span>,<span class="attr">"arrivalTimestamp"</span>:<span class="number">1578987975128</span>,<span class="attr">"errorCode"</span>:<span class="string">"ES.MalformedData"</span>,<span class="attr">"errorMessage"</span>:<span class="string">"One or more records are malformed. Please ensure that each record is single valid JSON object and that it does not contain newlines."</span>,<span class="attr">"attemptEndingTimestamp"</span>:<span class="number">1578988096793</span>,<span class="attr">"rawData"</span>:<span class="string">"eyJ1c2VyX2lkIiA6IDIwMDAsICJib2FyZF9pZCIgOiAyMDAwMCwgInBsYXl0aW1lIiA6IDB9CnsidXNlcl9pZCIgOiAyMDAxLCAiYm9hcmRfaWQiIDogMjAwMDIsICJwbGF5dGltZSIgOiAxfQp7InVzZXJfaWQiIDogMjAwMiwgImJvYXJkX2lkIiA6IDIwMDAyLCAicGxheXRpbWUiIDogMn0K"</span>,<span class="attr">"subsequenceNumber"</span>:<span class="number">0</span>,<span class="attr">"esDocumentId"</span>:<span class="string">"49601782789714450298329765741201416363766281254427688962.0"</span>,<span class="attr">"esIndexName"</span>:<span class="string">"newline_character_test"</span>,<span class="attr">"esTypeName"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="테스트-케이스-결과-1"><a href="#테스트-케이스-결과-1" class="headerlink" title="테스트 케이스 결과"></a>테스트 케이스 결과</h2><blockquote>
<p>1개의 데이터 레코드에 3개의 이벤트 데이터를 Newline Character(“\n”)를 Delimeter로 사용하여 String 타입 값으로 저장하여 Kinesis Data Stream에 전송하였다.<br>S3에는 앞서 전송한 3개의 이벤트 데이터와 파일로 저장된다.<br>하지만 Amazon Elasticsearch에 인덱싱되지 않았으며, 인덱싱 되지 않은 이유는 Elastcisearch 인덱싱 형식에 맞지 않기 때문이다.</p>
</blockquote>
<h1 id="테스트-결과"><a href="#테스트-결과" class="headerlink" title="테스트 결과"></a>테스트 결과</h1><p>아래에는 테스트 케이스 별로 테스트한 내용을 정리한다.</p>
<blockquote>
<p>데이터 전송시 데이터 레코드 단위마다 1개의 이벤트 데이터에 Newline Character(“\n”)를 붙여서 저장하여 전송하는 경우</p>
<ul>
<li>각각의 이벤트 데이터는 Amazon Elasticsearch에 다큐먼트로 매칭되어 저장된다.</li>
<li>S3에 이벤트 데이터가 New Character(“\n”)가 처리되어 한 라인에 하나의 데이터가 저장되는 형태로 파일에 저장된다.</li>
</ul>
<p>데이터 전송시 데이터 1개의 레코드에 3개의 이벤트 데이터를 Newline Character(“\n”)를 Delimeter로 사용하여 하나의 문자열 형태로 전송하는 경우</p>
<ul>
<li>Amazon Elasticsearch에 인덱싱되지 않으며, 인덱싱 되지 않는 이유는 Elastcisearch 인덱싱 형식에 맞지 않기 때문이다.</li>
<li>S3에 3개의 이벤트 데이터와 이벤트간 Delimeter로 Newline Character가 포함된 값이 파일로 저장된다.</li>
</ul>
</blockquote>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a> <a class="tag tag--primary tag--small t-link" href="/tags/Kinesis-Data-Firehose/" rel="tag">Kinesis Data Firehose</a> <a class="tag tag--primary tag--small t-link" href="/tags/Kinesis-Data-Stream/" rel="tag">Kinesis Data Stream</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/01/10/Fluentd-Http-Input-Plugin-%EB%B6%80%ED%95%98-%EB%B0%8F-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    data-tooltip="Fluentd - Http Input Plugin 부하 및 성능 테스트"
                    aria-label="NEXT: Fluentd - Http Input Plugin 부하 및 성능 테스트"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Kevin. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/01/10/Fluentd-Http-Input-Plugin-%EB%B6%80%ED%95%98-%EB%B0%8F-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    data-tooltip="Fluentd - Http Input Plugin 부하 및 성능 테스트"
                    aria-label="NEXT: Fluentd - Http Input Plugin 부하 및 성능 테스트"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Kevin</h4>
        
            <div id="about-card-bio"><p>Kevin, 이용훈<br>어릴 때부터 코딩에 흥미를 가지고 살아왔습니다. 새로운 기술도 열정적으로 받아들이며 더 좋은 개발을 위하여 학습하고 경험하고 노력하고 있습니다.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Developer, DE</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                서울 / 대한민국
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/curtain.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'http://usehun0625.github.io/2020/01/15/Amazon-Elasticsearch-%EC%9D%B8%EB%8D%B1%EC%8B%B1-S3-%EC%A0%80%EC%9E%A5-Newline-Character-n-%EA%B0%80-%ED%8F%AC%ED%95%A8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8/';
              
            this.page.identifier = '2020/01/15/Amazon-Elasticsearch-인덱싱-S3-저장-Newline-Character-n-가-포함된-데이터-처리-테스트/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'usehun0625';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
