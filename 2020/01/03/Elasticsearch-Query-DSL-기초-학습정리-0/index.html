
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kevin의 블로그">
    <title>Elasticsearch query DSL 기초 학습정리 - Kevin의 블로그</title>
    <meta name="author" content="Kevin">
    
    
        <link rel="icon" href="http://usehun0625.github.io/assets/images/beer_favaicon.png">
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kevin","sameAs":["https://github.com/usehun0625/","mailto:usehun0625@gmail.com"],"image":"beer.jpg"},"articleBody":"\nElasticsearch 공식 사이트의 Query DSL에 대해 학습했던 부분을 정리한다. Elasticsearch - Query DSL과 관련된 모든 내용을 설명하고 공유하는 것이 이 문서의 목적은 아니며 자세한 설명은 공식 문서를 참고하도록 한다.\n\n이어지는 설명에서는 Kibana에서 제공하는 ‘Dev Tools’를 사용하여 Elasticsearch에 query하는 방식을 기준으로 설명한다. Postman과 같은 다른 툴을 사용하여 실습하는 경우 Elasticsearch에 대한 정보를 포함하여 query대상 URL을 지정해야한다.\n테스트 환경테스트 환경은 다음과 같다. \n\nElatiscsearch: 7.1.1\nKibana: 7.1.1\nMacOS: Catalina 10.15.2\n\n참고한 Elatiscsearch 공식문서의 버전은 다음과 같다. \n\n7.x\n\n샘플 데이터 Elasticsearch에 추가이 문서에서 사용하는 데이터는 Kibana에서 기본 제공되는 샘플 데이터를 사용한다.샘플 데이터를 설정하는 방법은 Kibana home에서 “Load a data set and a Kibana dashboard” 링크를 클릭한 후 3개의 Sample 데이터 중 Sample eCommerce orders를 선택한다. 아래에서 실습에서는 해당 데이터가 생성되있다는 가정하에 예시 Query를 작성했다. \n문서 범위이 문서에서 다루는 내용의 범위는 다음과 같다.\n\nQuery 요청과 응답에 대한 공통 부분 설명\nQuery and filter context\nCompound queries\nFull text queries\nMatch all\nTerm-level queries\n\nQuery 요청과 응답에 대한 공통 부분 설명Elasticsearch에서 Query를 사용할 때 공통적인 부분에 대한 설명은 다음과 같다. \n123456789&#123;    \"size\" : # 반환받는 Document 개수의 값이다    ,\"from\" : # 몇번째 문서부터 가져올지 지정. 기본값은 0이다    ,\"timeout\" : # 검색 요청시 결과를 받는 데까지 걸리는 시간이다. timeout을 너무 작게하면 전체 샤드에서 timeout을 넘기지 않은 문서만 결과로 출력된다. 기본 값은 무한이다.    ,\"_source\" : # 검색시 필요한 필드만 출력하고 싶을 때 사용한다    ,\"query\" : # 검색 조건문을 설정할 때 사용한다    ,\"aggs\" : # 통계 및 집계 데이터를 설정할 때 사용한다    ,\"sort\" : # 문서 결과의 정렬 조건을 설정할 때 사용한다&#125;\n\nQuery의 응답에서 공통적인 부분에 대한 설명은 다음과 같다.\n1234567891011121314&#123;    \"took\" : # Query를 실행하는데 걸린 시간이다    ,\"timed_out\" : # Query 시간이 초과했는 지 True, False로 나타낸다    ,\"_shards\" : &#123;        \"total\" : # Query를 요청한 전체 샤드 개수이다        ,\"successful\" : # Query에 성공적으로 응답한 샤드 개수이다        ,\"failed\" : # Query에 실패한 샤드 개수이다    &#125;    ,\"hits\" : &#123;        \"total\" : # Query에 매칭된 문서의 전체 개수이다        ,\"max_score\" : # Query에 일치하는 문서의 스코어 값중 가장 높은 값이다        ,\"hits\" : # Query 결과를 표시한다    &#125;&#125;\n\n쿼리와 필터 컨텍스트(Query and filter context)관련성 점수(Relevance scores)Elasticsearch에서는 기본적으로 관련성 점수로 검색 결과를 정렬한다. 관련성 점수는 Query와 얼마나 잘 매칭되는 지 표현한 것이다. 관련성 점수는 실수이며 _score 메타 필드안에 값이 있다.관련성 점수는 Query 절이 Query context 혹은 Filter context인지에 따라 다르게 계산된다. \nQuery contextQuery context에서는, 문서가 Query와 얼마나 유사한지에 따라 점수가 계산된다. \nFilter contextFilter context에서는, 문서가 Query와 일치하는지를 구분한다. 점수는 계산되지 않는다. 점수를 계산하지 않기 때문에 Query context보다 검색 속도가 빠르다.자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-filter-context.html#relevance-scores\n\n복합 쿼리(Compound queries)Boolean queryboolean query는 query 필드 하위에 bool 필드를 정의하여 사용한다.boolean query는 다음과 같은 하위 쿼리를 정의하여 사용한다. boolean query는 다른 종류의 하위 쿼리를 사용하여 정의할 수 있다.\n\nmust: Must절에 있는 모든 Query가 일치하는 문서를 검색한다. score에 영향을 준다.\nfilter: Must절에 있는 모든 Query가 일치하는 문서를 검색한다. score에 영향을 주지 않는다.\nshould: Should절에 지정된 Query 중 하나라도 일치하는 문서를 검색한다.\nmust not: Must not절에 있는 모든 Query가 일치하지 않는 문서를 검색한다.\n\n하위 쿼리는 단일 쿼리(term, match, range 등)를 정의하여 사용하며, 여러개의 단일 쿼리를 정의(아래 예시의 should)하여 사용할 수도 있다.예시 Query는 다음과 같다.\n12345678910111213141516171819202122232425GET kibana_sample_data_ecommerce/_search&#123;  \"query\": &#123;    \"bool\": &#123;      \"must\": &#123;        \"term\" : &#123; \"customer_id\": 4&#125;      &#125;,      \"filter\": &#123;        \"term\": &#123;\"day_of_week\":\"Wednesday\"&#125;      &#125;,      \"must_not\": &#123;        \"range\": &#123;          \"order_date\": &#123; \"gte\": \"2016-12-21T06:51:50+00:00\",            \"lte\": \"2019-12-31T06:51:50+00:00\"          &#125;        &#125;      &#125;,      \"should\": [        &#123;\"term\": &#123; \"customer_last_name\":\"Garza\"&#125;&#125;,        &#123;\"term\": &#123; \"customer_last_name\":\"Solomon\"&#125;&#125;      ],      \"boost\": 1    &#125;  &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-bool-query.html\n\nDis_max querydis_max query는 query와 정확히 일치하는 Document에 가장 높은 점수를 부여하고 나머지 subqueries에 대해 매칭될 경우 tie_braker의 값을 곱해 최종 점수를 계산한다. tie_braker의 기본값은 0.0이며 최대값은 1.0이다.예시 Query는 다음과 같다. \n123456789101112GET kibana_sample_data_ecommerce/_search/&#123;    \"query\": &#123;        \"dis_max\" : &#123;            \"queries\" : [                &#123; \"term\" : &#123; \"day_of_week\" : \"Tuseday\" &#125;&#125;,                &#123; \"term\" : &#123; \"customer_id\" : \"24\" &#125;&#125;            ],            \"tie_breaker\" : 0.7        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html\n\n전문 쿼리(Full text queries)Match querymatch query를 이용해 query 필드로 정의된 텍스트와 매치되는 문서들을 검색할 수 있다. 유의 사항은 입력한 text가 검색 되기전 분석(analyze)과정을 거치고 검색에 사용된다는 것이다.match query는 query 필드로 정의된 텍스트에서 띄어쓰기를 기준으로 단어를 구분하여 검색한다. 아래 예시에서는 customer_full_name 필드 값이 “Eddie” 또는 “James” 인 다큐먼트를 검색한다.예시 Query는 다음과 같다. \n12345678910GET kibana_sample_data_ecommerce/_search&#123;    \"query\": &#123;        \"match\" : &#123;            \"customer_full_name\" : &#123;                \"query\" : \"Eddie James\"            &#125;        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query.html\n\nMatch phrase querymatch phrase query는 띄워쓰기까지 포함한 정확한 구(phrase)를 검색할때 사용한다. 입력된 text는 match query와 같이 분석되지만 token 단위로 원래의 구와 동일한 순서로 배치되어 있는 구만을 검색한다.예시 Query는 다음과 같다. \n12345678GET /_search&#123;    \"query\": &#123;        \"match_phrase\" : &#123;            \"message\" : \"this is a test\"        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query-phrase.html#query-dsl-match-query-phrase\n\nMulti-match queryMulti-match query를 이용하면 여러 개의 field에서 query를 검색할 수 있다.동일한 query를 다른 필드에 Match query를 사용한 것과 같은 결과를 얻을 수 있다.예시 Query는 다음과 같다. \n123456789GET /_search&#123;  \"query\": &#123;    \"multi_match\" : &#123;      \"query\":    \"this is a test\",       \"fields\": [ \"subject\", \"message\" ]     &#125;  &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-multi-match-query.html\n\nMatch all queryQuery에 매치되는 모든 Document를 검색한다. 검색 결과의 점수는 1.0이다.예시 Query는 다음과 같다. \n123456GET /_search&#123;    \"query\": &#123;        \"match_all\": &#123;&#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-all-query.html\n\n텀 레벨 쿼리(Term-level queries)Exists queryExists query는 메타 필드 검색과 관련된 쿼리이다.field에 정의한 이름의 필드가 존재하는 Document를 검색한다. 특정 Field의 값에는 여러 가지 이유로 값이 없을 수 있는 데, 이러한 값 없는 field가 있는 Documents들을 제외할 수 있는 query이다.예시 Query는 다음과 같다. \n12345678GET /_search&#123;    \"query\": &#123;        \"exists\": &#123;            \"field\": \"user\"        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-exists-query.html\n\nRange query지정한 범위의 값이 포함된 문서를 리턴한다.예시 Query는 다음과 같다. \n123456789101112GET _search&#123;    \"query\": &#123;        \"range\" : &#123;            \"age\" : &#123;                \"gte\" : 10,                \"lte\" : 20,                \"boost\" : 2.0            &#125;        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-range-query.html\n\nTerm query지정한 Field에 입력한 Term이 정확하게 매칭되는 Document를 리턴한다.예시 Query는 다음과 같다. \n1234567891011GET /_search&#123;    \"query\": &#123;        \"term\": &#123;            \"user\": &#123;                \"value\": \"Kimchy\",                \"boost\": 1.0            &#125;        &#125;    &#125;&#125;\n\nTerm query를 Text field에 사용하는 것은 좋지 않다.기본값 설정으로, Elasticsearch에서는 Text fields에 대해 분석을 하고 query를 수행한다. 이것은 특정 field의 값을 찾는 데 어려움을 야기할 수 있다.따라서, Text field를 찾기 위해서는 Match query를 사용하는 것을 권장한다.\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-term-query.html\n\nTerms query지정한 Field에 하나 또는 하나 이상의 Term이 정확하게 매칭되는 Document를 리턴한다.예시 Query는 다음과 같다. \n123456789GET /_search&#123;    \"query\" : &#123;        \"terms\" : &#123;            \"user\" : [\"kimchy\", \"elasticsearch\"],            \"boost\" : 1.0        &#125;    &#125;&#125;\n자세한 내용은 다음 공식 문서를 통하여 확인한다.\n\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-terms-query.html\n\n참고 문서\nElasticsearch 공식 문서: https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html\nElasticsearch 쿼리 DSL 기초: https://bakyeono.net/post/2016-08-20-elasticsearch-querydsl-basic.html#bool-쿼리\nElasticsearch 입문하기(4) - 다양한 검색 방법 ( Query DSL ): https://victorydntmd.tistory.com/314 \nElasticsearch - 2.검색 API(Elasticsearch Query DSL): https://coding-start.tistory.com/165\n\n","dateCreated":"2020-01-03T16:56:29+09:00","dateModified":"2020-02-09T17:23:19+09:00","datePublished":"2020-01-03T16:56:29+09:00","description":"\nElasticsearch 공식 사이트의 Query DSL에 대해 학습했던 부분을 정리한다. Elasticsearch - Query DSL과 관련된 모든 내용을 설명하고 공유하는 것이 이 문서의 목적은 아니며 자세한 설명은 공식 문서를 참고하도록 한다.","headline":"Elasticsearch query DSL 기초 학습정리","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"},"publisher":{"@type":"Organization","name":"Kevin","sameAs":["https://github.com/usehun0625/","mailto:usehun0625@gmail.com"],"image":"beer.jpg","logo":{"@type":"ImageObject","url":"beer.jpg"}},"url":"http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/","keywords":"Elasticsearch, Query DSL"}</script>
    <meta name="description" content="Elasticsearch 공식 사이트의 Query DSL에 대해 학습했던 부분을 정리한다. Elasticsearch - Query DSL과 관련된 모든 내용을 설명하고 공유하는 것이 이 문서의 목적은 아니며 자세한 설명은 공식 문서를 참고하도록 한다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Elasticsearch query DSL 기초 학습정리">
<meta property="og:url" content="http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/index.html">
<meta property="og:site_name" content="Kevin의 블로그">
<meta property="og:description" content="Elasticsearch 공식 사이트의 Query DSL에 대해 학습했던 부분을 정리한다. Elasticsearch - Query DSL과 관련된 모든 내용을 설명하고 공유하는 것이 이 문서의 목적은 아니며 자세한 설명은 공식 문서를 참고하도록 한다.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-01-03T07:56:29.000Z">
<meta property="article:modified_time" content="2020-02-09T08:23:19.584Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="Elasticsearch">
<meta property="article:tag" content="Query DSL">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://usehun0625.github.io/assets/images/beer.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Kevin의 블로그
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Kevin</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Kevin, 이용훈<br>어릴 때부터 코딩에 흥미를 가지고 살아왔습니다. 새로운 기술도 열정적으로 받아들이며 더 좋은 개발을 위하여 학습하고 경험하고 노력하고 있습니다.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/"
                            title="홈"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">홈</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="카테고리"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="태그"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="/all-archives"
                            
                            title="아카이브"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/usehun0625/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:usehun0625@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Elasticsearch query DSL 기초 학습정리
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-01-03T16:56:29+09:00">
	
		    Jan 03, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84/">검색엔진</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#테스트-환경"><span class="toc-text">테스트 환경</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#샘플-데이터-Elasticsearch에-추가"><span class="toc-text">샘플 데이터 Elasticsearch에 추가</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#문서-범위"><span class="toc-text">문서 범위</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Query-요청과-응답에-대한-공통-부분-설명"><span class="toc-text">Query 요청과 응답에 대한 공통 부분 설명</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#쿼리와-필터-컨텍스트-Query-and-filter-context"><span class="toc-text">쿼리와 필터 컨텍스트(Query and filter context)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#관련성-점수-Relevance-scores"><span class="toc-text">관련성 점수(Relevance scores)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-context"><span class="toc-text">Query context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter-context"><span class="toc-text">Filter context</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#복합-쿼리-Compound-queries"><span class="toc-text">복합 쿼리(Compound queries)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Boolean-query"><span class="toc-text">Boolean query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dis-max-query"><span class="toc-text">Dis_max query</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#전문-쿼리-Full-text-queries"><span class="toc-text">전문 쿼리(Full text queries)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Match-query"><span class="toc-text">Match query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Match-phrase-query"><span class="toc-text">Match phrase query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multi-match-query"><span class="toc-text">Multi-match query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Match-all-query"><span class="toc-text">Match all query</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#텀-레벨-쿼리-Term-level-queries"><span class="toc-text">텀 레벨 쿼리(Term-level queries)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Exists-query"><span class="toc-text">Exists query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Range-query"><span class="toc-text">Range query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Term-query"><span class="toc-text">Term query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Terms-query"><span class="toc-text">Terms query</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#참고-문서"><span class="toc-text">참고 문서</span></a></li></ol>
<p>Elasticsearch 공식 사이트의 Query DSL에 대해 학습했던 부분을 정리한다. Elasticsearch - Query DSL과 관련된 모든 내용을 설명하고 공유하는 것이 이 문서의 목적은 아니며 자세한 설명은 공식 문서를 참고하도록 한다.</p>
<a id="more"></a>
<p>이어지는 설명에서는 Kibana에서 제공하는 ‘Dev Tools’를 사용하여 Elasticsearch에 query하는 방식을 기준으로 설명한다. Postman과 같은 다른 툴을 사용하여 실습하는 경우 Elasticsearch에 대한 정보를 포함하여 query대상 URL을 지정해야한다.</p>
<h1 id="테스트-환경"><a href="#테스트-환경" class="headerlink" title="테스트 환경"></a>테스트 환경</h1><p>테스트 환경은 다음과 같다. </p>
<ul>
<li>Elatiscsearch: 7.1.1</li>
<li>Kibana: 7.1.1</li>
<li>MacOS: Catalina 10.15.2</li>
</ul>
<p>참고한 Elatiscsearch 공식문서의 버전은 다음과 같다. </p>
<ul>
<li>7.x</li>
</ul>
<h1 id="샘플-데이터-Elasticsearch에-추가"><a href="#샘플-데이터-Elasticsearch에-추가" class="headerlink" title="샘플 데이터 Elasticsearch에 추가"></a>샘플 데이터 Elasticsearch에 추가</h1><p>이 문서에서 사용하는 데이터는 Kibana에서 기본 제공되는 샘플 데이터를 사용한다.<br>샘플 데이터를 설정하는 방법은 Kibana home에서 “Load a data set and a Kibana dashboard” 링크를 클릭한 후 3개의 Sample 데이터 중 Sample eCommerce orders를 선택한다. 아래에서 실습에서는 해당 데이터가 생성되있다는 가정하에 예시 Query를 작성했다. </p>
<h1 id="문서-범위"><a href="#문서-범위" class="headerlink" title="문서 범위"></a>문서 범위</h1><p>이 문서에서 다루는 내용의 범위는 다음과 같다.</p>
<ul>
<li>Query 요청과 응답에 대한 공통 부분 설명</li>
<li>Query and filter context</li>
<li>Compound queries</li>
<li>Full text queries</li>
<li>Match all</li>
<li>Term-level queries</li>
</ul>
<h1 id="Query-요청과-응답에-대한-공통-부분-설명"><a href="#Query-요청과-응답에-대한-공통-부분-설명" class="headerlink" title="Query 요청과 응답에 대한 공통 부분 설명"></a>Query 요청과 응답에 대한 공통 부분 설명</h1><p>Elasticsearch에서 Query를 사용할 때 공통적인 부분에 대한 설명은 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"size"</span> : <span class="comment"># 반환받는 Document 개수의 값이다</span></span><br><span class="line">    ,<span class="string">"from"</span> : <span class="comment"># 몇번째 문서부터 가져올지 지정. 기본값은 0이다</span></span><br><span class="line">    ,<span class="string">"timeout"</span> : <span class="comment"># 검색 요청시 결과를 받는 데까지 걸리는 시간이다. timeout을 너무 작게하면 전체 샤드에서 timeout을 넘기지 않은 문서만 결과로 출력된다. 기본 값은 무한이다.</span></span><br><span class="line">    ,<span class="string">"_source"</span> : <span class="comment"># 검색시 필요한 필드만 출력하고 싶을 때 사용한다</span></span><br><span class="line">    ,<span class="string">"query"</span> : <span class="comment"># 검색 조건문을 설정할 때 사용한다</span></span><br><span class="line">    ,<span class="string">"aggs"</span> : <span class="comment"># 통계 및 집계 데이터를 설정할 때 사용한다</span></span><br><span class="line">    ,<span class="string">"sort"</span> : <span class="comment"># 문서 결과의 정렬 조건을 설정할 때 사용한다</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Query의 응답에서 공통적인 부분에 대한 설명은 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"took"</span> : <span class="comment"># Query를 실행하는데 걸린 시간이다</span></span><br><span class="line">    ,<span class="string">"timed_out"</span> : <span class="comment"># Query 시간이 초과했는 지 True, False로 나타낸다</span></span><br><span class="line">    ,<span class="string">"_shards"</span> : &#123;</span><br><span class="line">        <span class="string">"total"</span> : <span class="comment"># Query를 요청한 전체 샤드 개수이다</span></span><br><span class="line">        ,<span class="string">"successful"</span> : <span class="comment"># Query에 성공적으로 응답한 샤드 개수이다</span></span><br><span class="line">        ,<span class="string">"failed"</span> : <span class="comment"># Query에 실패한 샤드 개수이다</span></span><br><span class="line">    &#125;</span><br><span class="line">    ,<span class="string">"hits"</span> : &#123;</span><br><span class="line">        <span class="string">"total"</span> : <span class="comment"># Query에 매칭된 문서의 전체 개수이다</span></span><br><span class="line">        ,<span class="string">"max_score"</span> : <span class="comment"># Query에 일치하는 문서의 스코어 값중 가장 높은 값이다</span></span><br><span class="line">        ,<span class="string">"hits"</span> : <span class="comment"># Query 결과를 표시한다</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="쿼리와-필터-컨텍스트-Query-and-filter-context"><a href="#쿼리와-필터-컨텍스트-Query-and-filter-context" class="headerlink" title="쿼리와 필터 컨텍스트(Query and filter context)"></a>쿼리와 필터 컨텍스트(Query and filter context)</h1><h2 id="관련성-점수-Relevance-scores"><a href="#관련성-점수-Relevance-scores" class="headerlink" title="관련성 점수(Relevance scores)"></a>관련성 점수(Relevance scores)</h2><p>Elasticsearch에서는 기본적으로 관련성 점수로 검색 결과를 정렬한다. 관련성 점수는 Query와 얼마나 잘 매칭되는 지 표현한 것이다. 관련성 점수는 실수이며 _score 메타 필드안에 값이 있다.<br>관련성 점수는 Query 절이 Query context 혹은 Filter context인지에 따라 다르게 계산된다. </p>
<h2 id="Query-context"><a href="#Query-context" class="headerlink" title="Query context"></a>Query context</h2><p>Query context에서는, 문서가 Query와 얼마나 유사한지에 따라 점수가 계산된다. </p>
<h2 id="Filter-context"><a href="#Filter-context" class="headerlink" title="Filter context"></a>Filter context</h2><p>Filter context에서는, 문서가 Query와 일치하는지를 구분한다. 점수는 계산되지 않는다. 점수를 계산하지 않기 때문에 Query context보다 검색 속도가 빠르다.<br>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-filter-context.html#relevance-scores" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-filter-context.html#relevance-scores</a></li>
</ul>
<h1 id="복합-쿼리-Compound-queries"><a href="#복합-쿼리-Compound-queries" class="headerlink" title="복합 쿼리(Compound queries)"></a>복합 쿼리(Compound queries)</h1><h2 id="Boolean-query"><a href="#Boolean-query" class="headerlink" title="Boolean query"></a>Boolean query</h2><p>boolean query는 query 필드 하위에 bool 필드를 정의하여 사용한다.<br>boolean query는 다음과 같은 하위 쿼리를 정의하여 사용한다. boolean query는 다른 종류의 하위 쿼리를 사용하여 정의할 수 있다.</p>
<ul>
<li>must: Must절에 있는 모든 Query가 일치하는 문서를 검색한다. score에 영향을 준다.</li>
<li>filter: Must절에 있는 모든 Query가 일치하는 문서를 검색한다. score에 영향을 주지 않는다.</li>
<li>should: Should절에 지정된 Query 중 하나라도 일치하는 문서를 검색한다.</li>
<li>must not: Must not절에 있는 모든 Query가 일치하지 않는 문서를 검색한다.</li>
</ul>
<p>하위 쿼리는 단일 쿼리(term, match, range 등)를 정의하여 사용하며, 여러개의 단일 쿼리를 정의(아래 예시의 should)하여 사용할 수도 있다.<br>예시 Query는 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123;</span><br><span class="line">    <span class="string">"bool"</span>: &#123;</span><br><span class="line">      <span class="string">"must"</span>: &#123;</span><br><span class="line">        <span class="string">"term"</span> : &#123; <span class="string">"customer_id"</span>: 4&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"filter"</span>: &#123;</span><br><span class="line">        <span class="string">"term"</span>: &#123;<span class="string">"day_of_week"</span>:<span class="string">"Wednesday"</span>&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"must_not"</span>: &#123;</span><br><span class="line">        <span class="string">"range"</span>: &#123;</span><br><span class="line">          <span class="string">"order_date"</span>: &#123; <span class="string">"gte"</span>: <span class="string">"2016-12-21T06:51:50+00:00"</span>,</span><br><span class="line">            <span class="string">"lte"</span>: <span class="string">"2019-12-31T06:51:50+00:00"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"should"</span>: [</span><br><span class="line">        &#123;<span class="string">"term"</span>: &#123; <span class="string">"customer_last_name"</span>:<span class="string">"Garza"</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">"term"</span>: &#123; <span class="string">"customer_last_name"</span>:<span class="string">"Solomon"</span>&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"boost"</span>: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-bool-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-bool-query.html</a></li>
</ul>
<h2 id="Dis-max-query"><a href="#Dis-max-query" class="headerlink" title="Dis_max query"></a>Dis_max query</h2><p>dis_max query는 query와 정확히 일치하는 Document에 가장 높은 점수를 부여하고 나머지 subqueries에 대해 매칭될 경우 tie_braker의 값을 곱해 최종 점수를 계산한다. tie_braker의 기본값은 0.0이며 최대값은 1.0이다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search/</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"dis_max"</span> : &#123;</span><br><span class="line">            <span class="string">"queries"</span> : [</span><br><span class="line">                &#123; <span class="string">"term"</span> : &#123; <span class="string">"day_of_week"</span> : <span class="string">"Tuseday"</span> &#125;&#125;,</span><br><span class="line">                &#123; <span class="string">"term"</span> : &#123; <span class="string">"customer_id"</span> : <span class="string">"24"</span> &#125;&#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"tie_breaker"</span> : 0.7</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html</a></li>
</ul>
<h1 id="전문-쿼리-Full-text-queries"><a href="#전문-쿼리-Full-text-queries" class="headerlink" title="전문 쿼리(Full text queries)"></a>전문 쿼리(Full text queries)</h1><h2 id="Match-query"><a href="#Match-query" class="headerlink" title="Match query"></a>Match query</h2><p>match query를 이용해 query 필드로 정의된 텍스트와 매치되는 문서들을 검색할 수 있다. 유의 사항은 입력한 text가 검색 되기전 분석(analyze)과정을 거치고 검색에 사용된다는 것이다.<br>match query는 query 필드로 정의된 텍스트에서 띄어쓰기를 기준으로 단어를 구분하여 검색한다. 아래 예시에서는 customer_full_name 필드 값이 “Eddie” 또는 “James” 인 다큐먼트를 검색한다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"match"</span> : &#123;</span><br><span class="line">            <span class="string">"customer_full_name"</span> : &#123;</span><br><span class="line">                <span class="string">"query"</span> : <span class="string">"Eddie James"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query.html</a></li>
</ul>
<h2 id="Match-phrase-query"><a href="#Match-phrase-query" class="headerlink" title="Match phrase query"></a>Match phrase query</h2><p>match phrase query는 띄워쓰기까지 포함한 정확한 구(phrase)를 검색할때 사용한다. 입력된 text는 match query와 같이 분석되지만 token 단위로 원래의 구와 동일한 순서로 배치되어 있는 구만을 검색한다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"match_phrase"</span> : &#123;</span><br><span class="line">            <span class="string">"message"</span> : <span class="string">"this is a test"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query-phrase.html#query-dsl-match-query-phrase" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-query-phrase.html#query-dsl-match-query-phrase</a></li>
</ul>
<h2 id="Multi-match-query"><a href="#Multi-match-query" class="headerlink" title="Multi-match query"></a>Multi-match query</h2><p>Multi-match query를 이용하면 여러 개의 field에서 query를 검색할 수 있다.<br>동일한 query를 다른 필드에 Match query를 사용한 것과 같은 결과를 얻을 수 있다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123;</span><br><span class="line">    <span class="string">"multi_match"</span> : &#123;</span><br><span class="line">      <span class="string">"query"</span>:    <span class="string">"this is a test"</span>, </span><br><span class="line">      <span class="string">"fields"</span>: [ <span class="string">"subject"</span>, <span class="string">"message"</span> ] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-multi-match-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-multi-match-query.html</a></li>
</ul>
<h2 id="Match-all-query"><a href="#Match-all-query" class="headerlink" title="Match all query"></a>Match all query</h2><p>Query에 매치되는 모든 Document를 검색한다. 검색 결과의 점수는 1.0이다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"match_all"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-all-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-match-all-query.html</a></li>
</ul>
<h1 id="텀-레벨-쿼리-Term-level-queries"><a href="#텀-레벨-쿼리-Term-level-queries" class="headerlink" title="텀 레벨 쿼리(Term-level queries)"></a>텀 레벨 쿼리(Term-level queries)</h1><h2 id="Exists-query"><a href="#Exists-query" class="headerlink" title="Exists query"></a>Exists query</h2><p>Exists query는 메타 필드 검색과 관련된 쿼리이다.<br>field에 정의한 이름의 필드가 존재하는 Document를 검색한다. 특정 Field의 값에는 여러 가지 이유로 값이 없을 수 있는 데, 이러한 값 없는 field가 있는 Documents들을 제외할 수 있는 query이다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"exists"</span>: &#123;</span><br><span class="line">            <span class="string">"field"</span>: <span class="string">"user"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-exists-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-exists-query.html</a></li>
</ul>
<h2 id="Range-query"><a href="#Range-query" class="headerlink" title="Range query"></a>Range query</h2><p>지정한 범위의 값이 포함된 문서를 리턴한다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"range"</span> : &#123;</span><br><span class="line">            <span class="string">"age"</span> : &#123;</span><br><span class="line">                <span class="string">"gte"</span> : 10,</span><br><span class="line">                <span class="string">"lte"</span> : 20,</span><br><span class="line">                <span class="string">"boost"</span> : 2.0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-range-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-range-query.html</a></li>
</ul>
<h2 id="Term-query"><a href="#Term-query" class="headerlink" title="Term query"></a>Term query</h2><p>지정한 Field에 입력한 Term이 정확하게 매칭되는 Document를 리턴한다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123;</span><br><span class="line">        <span class="string">"term"</span>: &#123;</span><br><span class="line">            <span class="string">"user"</span>: &#123;</span><br><span class="line">                <span class="string">"value"</span>: <span class="string">"Kimchy"</span>,</span><br><span class="line">                <span class="string">"boost"</span>: 1.0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Term query를 Text field에 사용하는 것은 좋지 않다.<br>기본값 설정으로, Elasticsearch에서는 Text fields에 대해 분석을 하고 query를 수행한다. 이것은 특정 field의 값을 찾는 데 어려움을 야기할 수 있다.<br>따라서, Text field를 찾기 위해서는 Match query를 사용하는 것을 권장한다.</p>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-term-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-term-query.html</a></li>
</ul>
<h2 id="Terms-query"><a href="#Terms-query" class="headerlink" title="Terms query"></a>Terms query</h2><p>지정한 Field에 하나 또는 하나 이상의 Term이 정확하게 매칭되는 Document를 리턴한다.<br>예시 Query는 다음과 같다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span> : &#123;</span><br><span class="line">        <span class="string">"terms"</span> : &#123;</span><br><span class="line">            <span class="string">"user"</span> : [<span class="string">"kimchy"</span>, <span class="string">"elasticsearch"</span>],</span><br><span class="line">            <span class="string">"boost"</span> : 1.0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자세한 내용은 다음 공식 문서를 통하여 확인한다.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-terms-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-terms-query.html</a></li>
</ul>
<h1 id="참고-문서"><a href="#참고-문서" class="headerlink" title="참고 문서"></a>참고 문서</h1><ul>
<li>Elasticsearch 공식 문서: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html</a></li>
<li>Elasticsearch 쿼리 DSL 기초: <a href="https://bakyeono.net/post/2016-08-20-elasticsearch-querydsl-basic.html#bool-쿼리" target="_blank" rel="noopener">https://bakyeono.net/post/2016-08-20-elasticsearch-querydsl-basic.html#bool-쿼리</a></li>
<li>Elasticsearch 입문하기(4) - 다양한 검색 방법 ( Query DSL ): <a href="https://victorydntmd.tistory.com/314" target="_blank" rel="noopener">https://victorydntmd.tistory.com/314</a> </li>
<li>Elasticsearch - 2.검색 API(Elasticsearch Query DSL): <a href="https://coding-start.tistory.com/165" target="_blank" rel="noopener">https://coding-start.tistory.com/165</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a> <a class="tag tag--primary tag--small t-link" href="/tags/Query-DSL/" rel="tag">Query DSL</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/01/10/Fluentd-Http-Input-Plugin-%EB%B6%80%ED%95%98-%EB%B0%8F-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    data-tooltip="Fluentd - Http Input Plugin 부하 및 성능 테스트"
                    aria-label="PREVIOUS: Fluentd - Http Input Plugin 부하 및 성능 테스트"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Kevin. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/01/10/Fluentd-Http-Input-Plugin-%EB%B6%80%ED%95%98-%EB%B0%8F-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8/"
                    data-tooltip="Fluentd - Http Input Plugin 부하 및 성능 테스트"
                    aria-label="PREVIOUS: Fluentd - Http Input Plugin 부하 및 성능 테스트"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/beer.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Kevin</h4>
        
            <div id="about-card-bio"><p>Kevin, 이용훈<br>어릴 때부터 코딩에 흥미를 가지고 살아왔습니다. 새로운 기술도 열정적으로 받아들이며 더 좋은 개발을 위하여 학습하고 경험하고 노력하고 있습니다.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Developer, DE</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                서울 / 대한민국
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/curtain.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'http://usehun0625.github.io/2020/01/03/Elasticsearch-Query-DSL-%EA%B8%B0%EC%B4%88-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-0/';
              
            this.page.identifier = '2020/01/03/Elasticsearch-Query-DSL-기초-학습정리-0/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'usehun0625';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
